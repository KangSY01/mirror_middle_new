<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Smart Mirror</title>
  <meta http-equiv="refresh" content="10">
  <link rel="stylesheet" href="/static/style.css">
  <script defer src="/static/app.js"></script>
</head>
<body>
  <style>
    body { background-color: black !important; margin: 0; overflow: hidden; }
  </style>

  <div class="top">
    <div class="title">Smart Mirror Â· {{ now }}</div>
    <div class="badge mode">{{ policy.ui_mode }}</div>
    <div class="badge cond">{{ cond.state }}</div>
  </div>

  {% if policy.ui_mode == "idle" %}
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 80vh;">
      
      <div style="text-align: center; margin-bottom: 40px;">
        <div style="font-size: 36px; font-weight: 800; color: white; margin-bottom: 10px;">ê±°ìš¸ ì•ì— ì„œë©´ ì‹œì‘í• ê²Œìš” ğŸ‘‹</div>
        <div style="font-size: 18px; color: #aaa;">ì¹´ë©”ë¼ë¡œ ì–¼êµ´ì„ ê°ì§€ ì¤‘â€¦</div>
      </div>

      <div style="width: 800px; height: 450px; border: 2px solid #444; border-radius: 15px; overflow: hidden; background: #111; box-shadow: 0 0 50px rgba(255,255,255,0.1);">
        <img src="{{ url_for('video_feed') }}" 
             style="width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1);">
      </div>

    </div>
  {% else %}
    <div class="grid">
      <!-- 1) ì„±ê³µí™•ë¥  -->
      <div class="card">
        <div class="card-title">ì™¸ì¶œ ì„±ê³µí™•ë¥ </div>
        <div class="big">{{ (risk_now.p * 100)|round(0) }}%</div>
        <div class="sub">5ë¶„ ì¡°ê¸°: {{ (risk_early.p * 100)|round(0) }}%</div>
        <div class="sub">ë¦¬ìŠ¤í¬: {{ ", ".join(risk_now.factors) if risk_now.factors else "ë‚®ìŒ" }}</div>
      </div>

      <!-- 2) ë‚ ì”¨ -->
      <div class="card">
        <div class="card-title">ë‚ ì”¨</div>
        <div class="big">
          {% if weather.temp is not none %}{{ weather.temp|round(0) }}Â°C{% else %}--{% endif %}
        </div>
        <div class="sub">ì²´ê° {{ weather.feels_like|round(0) if weather.feels_like is not none else "--" }}Â°C</div>
        <div class="sub">ê°•ìˆ˜í™•ë¥  {{ (precip_prob*100)|round(0) }}%</div>
      </div>

      <!-- 3) ë²„ìŠ¤ -->
      <div class="card">
        <div class="card-title">ë²„ìŠ¤(ê·¼ì²˜ ì •ë¥˜ì¥)</div>
        {% if stop %}
          <div class="big">{{ eta_min if eta_min is not none else "--" }}ë¶„</div>
          <div class="sub">{{ stop.nodeNm }}</div>
          <div class="sub">cityCode: {{ city_code if city_code else "ë¯¸ì„¤ì •(ì„¤ì • í•„ìš”)" }}</div>
          <div class="list">
            {% for a in arrivals_preview %}
              <div class="row">
                <div class="left">{{ a.routeNo }}</div>
                <div class="right">{{ a.arrTimeMin if a.arrTimeMin is not none else "--" }}ë¶„</div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="big">--</div>
          <div class="sub">ê·¼ì²˜ ì •ë¥˜ì¥ íƒìƒ‰ ì‹¤íŒ¨</div>
        {% endif %}
      </div>

      <!-- 4) ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
      <div class="card">
        <div class="card-title">ì†Œì§€í’ˆ ì²´í¬ ìˆœì„œ</div>
        <div class="mid">{{ " â†’ ".join(checklist_order) }}</div>
        <div class="sub">ë¦¬ìŠ¤í¬: {{ "/".join(checklist_risks) if checklist_risks else "ì—†ìŒ" }}</div>
        <button class="btn" onclick="sendInteraction()">í™•ì¸(í„°ì¹˜)</button>
      </div>

      <!-- 5) ì»¨ë””ì…˜ -->
      <div class="card">
        <div class="card-title">ì»¨ë””ì…˜(Edge CV)</div>
        <div class="mid">state: {{ cond.state }}</div>
        <div class="sub">blink/min: {{ cond.blink_per_min }}</div>
        <div class="sub">closed_ratio(10s): {{ cond.closed_ratio_10s }}</div>
        <div class="sub">head_motion_std: {{ cond.head_motion_std }}</div>
      </div>

      <!-- 6) ë¸Œë¦¬í•‘ -->
      <div class="card">
        <div class="card-title">ì˜¤ëŠ˜ì˜ ë¸Œë¦¬í•‘</div>
        <div class="sub">{{ briefing.summary }}</div>
        <ul>
          {% for p in briefing.action_points %}
            <li class="li">{{ p }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  {% endif %}
</body>
</html>